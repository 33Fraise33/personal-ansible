- name: Set buffer size for quic # https://github.com/lucas-clemente/quic-go/wiki/UDP-Receive-Buffer-Size
  sysctl:
    name: "net.core.rmem_max"
    value: "2500000"
    state: present

- name: Start cloudflared docker container
  docker_container:
    name: cloudflared
    image: cloudflare/cloudflared:latest
    networks:
      - name: macvlan333
        ipv4_address: "{{ docker_network.ipv4_prefix }}{{ docker_network.hosts.cloudflared }}"
        ipv6_address: "{{ docker_network.ipv6_prefix }}{{ docker_network.hosts.cloudflared }}"
    purge_networks: yes
    command: tunnel --no-autoupdate run --token {{ cloudflared.service_token }}
    restart: yes
    restart_policy: always
    state: started
    pull: true
    labels:
      traefik.enable: "false"